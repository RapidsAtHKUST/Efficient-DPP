#!/bin/bash

# getopt preprocessing
TEMP=`getopt -o hn:sdRAL --long help,sort,distinct,record,array,location,all -- "$@"`

# set will reorder the sequence of the parameters
eval set -- "$TEMP"

COMPARE_HOME="$(cd "`dirname "$0"`"/../..; pwd)"
DATA_DIR=$COMPARE_HOME/data/

# parameters
DATASIZE=16000000					# default data size if 16,000,000
SORTED=false						# to sort the data
DISTINCT=false						# to generate distinct data
ALL=true							# to generate record, array and location data

# whether to generate records, arrays and locations
GEN_REC=false
GEN_ARR=false
GEN_LOC=false

# data directory
OUTPUT_REC_DIR="none"
OUTPUT_ARR_DIR="none"
OUTPUT_LOC_DIR="none"

# process the parameters
while true ; do
	case "$1" in
		-h|--help)
			echo "Options:";
			echo " -h, --help					show usage guide";
			echo;
			echo " -s, --sort					generate sorted data (distinct)";
			echo " -d, --distinct				generate distinct data"
			echo;
			echo " -R, --record					generate record data"
			echo " -A, --array					generate int array data"
			echo " -L, --location				generate location data(distinct int array starting from 0)"
			echo " --all						generate record, array and location data(default)"
			echo " -n						set the data size(default=16,000,000)";
			exit 1 
		shift
		;;	
		
		-s|--sort)			SORTED=true					; shift		;;
		-d|--distinct)		DISTINCT=true				; shift		;;
		-n)					DATASIZE=$2					; shift 2	;;
		-R|--record)		ALL=false; GEN_REC=true		; shift		;;
		-A|--array)			ALL=false; GEN_ARR=true		; shift		;;
		-L|--location)		ALL=false; GEN_LOC=true		; shift		;;
		--all)				ALL=true					; shift		;;
		--)					shift ; break ;;
		*)					echo $1; exit 1 
	esac
done

#output the parameters for checking
echo ""
echo "Starting to generate data..."

echo "Output data size : $DATASIZE"			# output data size

# establish the data folder
REC_PREFIX="rec"
ARR_PREFIX="arr"
LOC_PREFIX="loc"

#POSTFIX="${DATASIZE}_`date +%Y%m%d_%k%M%S`"
POSTFIX="${DATASIZE}"

FOLDER_NAME="data_$POSTFIX"
FOLDER_DIR=$DATA_DIR$FOLDER_NAME

`mkdir -p "$FOLDER_DIR"`


if [ $ALL == true ] 
then
	OUTPUT_REC_DIR=$FOLDER_DIR"/${REC_PREFIX}_$POSTFIX.data"
	OUTPUT_ARR_DIR=$FOLDER_DIR"/${ARR_PREFIX}_$POSTFIX.data"
	OUTPUT_LOC_DIR=$FOLDER_DIR"/${LOC_PREFIX}_$POSTFIX.data"

	echo "Output record data directory : $OUTPUT_REC_DIR"
	echo "Output array data directory :  $OUTPUT_ARR_DIR"
	echo "Output location data directory : $OUTPUT_LOC_DIR"
else
	if [ $GEN_REC == true ]
	then
		OUTPUT_REC_DIR=$FOLDER_DIR"/${REC_PREFIX}_$POSTFIX.data"
		echo "Output record data directory : $OUTPUT_REC_DIR"
	fi

	if [ $GEN_ARR == true ]
	then
		OUTPUT_ARR_DIR=$FOLDER_DIR"/${ARR_PREFIX}_$POSTFIX.data"
		echo "Output array data directory : $OUTPUT_ARR_DIR"
	fi

	if [ $GEN_LOC == true ]
	then
		OUTPUT_LOC_DIR=$DATA_DIR"/${LOC_PREFIX}_$POSTFIX.data"
		echo "Output location data directory : $OUTPUT_LOC_DIR"
	fi

fi

eval "$COMPARE_HOME/data_generation/bin/executor $OUTPUT_REC_DIR $OUTPUT_ARR_DIR $OUTPUT_LOC_DIR $DATASIZE $SORTED $DISTINCT"
echo "Data generation finished..."

